<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>滨江空间交互地图</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.49.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.49.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }
    </style>
</head>
<body>

<style>
    #menu {
        background: #fff;
        position: absolute;
        z-index: 1;
        top: 10px;
        right: 10px;
        border-radius: 3px;
        width: 120px;
        border: 1px solid rgba(0,0,0,0.4);
        font-family: 'Open Sans', sans-serif;
    }

    #menu a {
        font-size: 13px;
        color: #404040;
        display: block;
        margin: 0;
        padding: 0;
        padding: 10px;
        text-decoration: none;
        border-bottom: 1px solid rgba(0,0,0,0.25);
        text-align: center;
    }

    #menu a:last-child {
        border: none;
    }

    #menu a:hover {
        background-color: #f8f8f8;
        color: #404040;
    }

    #menu a.active {
        background-color: #3887be;
        color: #ffffff;
    }

    #menu a.active:hover {
        background: #3074a4;
    }
	
	#copyright {
		position: fixed;
		bottom: 0;
		padding: 10px 10px 10px 10px;
		font-size: 12px;
		background: rgba(255,255,255,0.5);
		z-index: 10293;
	}
</style>

<nav id="menu"></nav>
<div id="map"></div>
<div id="copyright">&copy; 2018 上海社科院文学所课题组<br />制图：朱恬骅 <a href="sources.html" target="_blank">数据来源</a></div>

<script>
mapboxgl.accessToken = 'pk.eyJ1Ijoiemh1dGgiLCJhIjoiY2ptOGNnbTcyMDA5bjNxcjF6bG1pOGR6ciJ9.SC1C73pxf6UqDlReAfcSJw';
var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/zhuth/cjm8clqf6ekbl2snxsl8mfj1x',
    zoom: 10.4,
    center: [121.613, 31.1787]
});
var toggleableLayerIds = [ 
	['艺术场馆名', 'artspaces-binjiang'],
	['艺术场馆热力图', 'artspaces-binjiang-9dmiy2'],
	['书店', 'sh-0612-0u577f'],
	['文化场馆名', 'sh-1401-08'],
	['文化场馆热力图', 'sh-1401-08-2ti3m3'],
	['地铁站', 'ditiezhan'],
	['轮渡', 'ferry'],
	['游艇', 'youting'],
	['购物中心', 'sh-0601'],
	['电竞馆', 'sh-djg-3z8o2h'],
	['郊野公园', 'jygy']
];

map.on('load', function () {
	for (var i = 0; i < toggleableLayerIds.length; i++) {
		var id = toggleableLayerIds[i][1], disp_text = toggleableLayerIds[i][0];

		var link = document.createElement('a');
		link.href = '#';
		link.className = map.getLayoutProperty(id, 'visibility') === 'visible' ? 'active' : '';
		link.textContent = disp_text;
		link.data = id;

		link.onclick = function (e) {
			var clickedLayer = this.data;
			e.preventDefault();
			e.stopPropagation();

			var visibility = map.getLayoutProperty(clickedLayer, 'visibility');

			if (visibility === 'visible') {
				map.setLayoutProperty(clickedLayer, 'visibility', 'none');
				this.className = '';
			} else {
				this.className = 'active';
				map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
			}
		};

		var layers = document.getElementById('menu');
		layers.appendChild(link);
	}
});
</script>

</body>
</html>
